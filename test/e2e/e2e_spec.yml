description: |
  End-to-end tests for Docker integration

scenarios:
  - description: |
      This scenario will verify that metrics from docker integration are correcly collected.
    before:
      - docker-compose up -d
    after:
      - docker-compose down -v
    integrations:
      - name: nri-powerdns
        binary_path: ../target/bin/nri-powerdns
        exporter_binary_path: ../target/bin/powerdns-exporter
        config:
          powerdns_url: http://localhost:8081/api/v1/
          exporter_port: 9121
          api_key: authoritative-secret
    tests:
      nrqls:
        - query: "SELECT average(powerdns_authoritative_queries_total) FROM Metric"
      entities:
        - type: "POWERDNS_AUTHORITATIVE"
          data_type: "Metric"
          metric_name: "powerdns_authoritative_up"
        - type: "POWERDNS_RECURSOR"
          data_type: "Metric"
          metric_name: "powerdns_recursor_up"
      metrics:
        - source: "docker.yml"
          except_entities:
            - POWERDNS_AUTHORITATIVE
          except_metrics:
            - powerdns_authoritative_answers_bytes_total
            - powerdns_recursor_cache_lookups_total
          # additionals: ""
