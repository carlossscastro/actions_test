description: |
  End-to-end tests for Docker integration

scenarios:
  - description: |
      This scenario will verify that metrics from docker integration are correcly collected.
    before:
      - docker-compose up -d
    after:
      - docker-compose down -v
    integrations:
      - name: nri-docker
        when:
          feature: docker_enabled
          file_exists: /var/run/docker.sock
        interval: 15s
      - name: nri-docker
        when:
          feature: docker_enabled
          env_exists:
            FARGATE: "true"
        interval: 15s
    tests:
      nrqls:
        - query: "SELECT average(powerdns_authoritative_queries_total) FROM Metric"
      entities:
        - type: "POWERDNS_AUTHORITATIVE"
          data_type: "Metric"
          metric_name: "powerdns_authoritative_up"
        - type: "POWERDNS_RECURSOR"
          data_type: "Metric"
          metric_name: "powerdns_recursor_up"
      metrics:
        - source: "docker.yml"
          except_entities:
            - POWERDNS_AUTHORITATIVE
          except_metrics:
            - powerdns_authoritative_answers_bytes_total
            - powerdns_recursor_cache_lookups_total
          # additionals: ""
